import { Meta, Markdown, ArgTypes, Canvas, Story } from "storybook/blocks";
import * as Stories from "./InlineEditLabel.stories";
import ReadmeSource from "./README.md?raw";

const scaffoldRefMatch =
  ReadmeSource.match(/#\s*scaffold_ref:\s*([^\s]+)/i) ??
  ReadmeSource.match(/scaffold_ref:\s*([^\s]+)/i);
const ownerCommentMatch = ReadmeSource.match(/<!--\s*_Owner:\s*(@[^\s>]+)\s*-->/i);
const ownerLineMatch = ReadmeSource.match(/^Owner:\s*(@[^\s]+)/im);

const scaffoldRef = scaffoldRefMatch ? scaffoldRefMatch[1].trim() : "Missing scaffold_ref";
const ownerHandle =
  ownerCommentMatch?.[1]?.trim() ??
  ownerLineMatch?.[1]?.trim() ??
  "Unassigned";
const isScaffoldMissing = scaffoldRef === "Missing scaffold_ref";
const isOwnerMissing = ownerHandle === "Unassigned";

<Meta of={Stories} />

<div style={{ display: "flex", gap: "1rem", marginBottom: "1rem", flexWrap: "wrap" }}>
  <div>
    <div style={{ fontSize: "0.75rem", letterSpacing: "0.08em", textTransform: "uppercase", color: "var(--text-muted-color)" }}>
      Template
    </div>
    <code style={isScaffoldMissing ? { color: "var(--color-danger-text)" } : undefined}>{scaffoldRef}</code>
  </div>
  <div>
    <div style={{ fontSize: "0.75rem", letterSpacing: "0.08em", textTransform: "uppercase", color: "var(--text-muted-color)" }}>
      Owner
    </div>
    <code style={isOwnerMissing ? { color: "var(--color-danger-text)" } : undefined}>{ownerHandle}</code>
  </div>
</div>

<Markdown>{ReadmeSource}</Markdown>

## Interactive
<Canvas>
  <Story of={Stories.Basic} />
</Canvas>

## Empty state
<Canvas>
  <Story of={Stories.EmptyState} />
</Canvas>

## Interaction test
<Canvas>
  <Story of={Stories.Interaction} />
</Canvas>

## Error path
<Canvas>
  <Story of={Stories.RetryOnError} />
</Canvas>

## Props
<ArgTypes of={Stories} />
